---
name: CloudMailin Webhook & iCal Parsing
status: open
created: 2025-10-16T03:45:15Z
updated: 2025-10-16T07:39:30Z
github: https://github.com/ChrisNZ2016/recordings2/issues/8
depends_on: [001]
parallel: false
conflicts_with: []
---

# Task 003: CloudMailin Webhook & iCal Parsing

## Description

Build /api/webhooks/cloudmailin endpoint, parse iCal attachments using ical.js, validate signatures, store meetings in database.

**Note**: This task depends on Task 001 (Database Setup) being completed first.

## Size & Effort

- **Size**: L (Large)
- **Estimated Hours**: 24-32 hours

## Dependencies

- **Dependencies**: Task 001 (Database Setup & Schema)
- **Requires**: Database tables and Drizzle ORM configuration

## Acceptance Criteria

- [ ] `/api/webhooks/cloudmailin` endpoint created (POST route)
- [ ] CloudMailin signature validation implemented
- [ ] iCal attachment parsing working (using ical.js library)
- [ ] Meeting metadata extracted:
  - Meeting title (SUMMARY field)
  - Meeting date/time (DTSTART field)
  - Meeting URL (LOCATION or URL field)
  - Participants (ATTENDEE fields)
- [ ] Meeting records stored in database with status: `scheduled`
- [ ] Error handling for:
  - Invalid signatures
  - Malformed iCal files
  - Missing required fields
  - Database insertion failures
- [ ] Logging implemented for:
  - Successful webhook events
  - Failed parsing attempts
  - Database operations
- [ ] Return appropriate HTTP status codes (200, 400, 401, 500)

## Technical Notes

- Use CloudMailin's signature validation to verify authentic requests
- Parse iCal attachments using `ical.js` library
- Handle multiple formats (invitation vs update events)
- Extract Zoom/Google Meet/Teams URLs from LOCATION field
- Store raw iCal data for debugging purposes (optional field)
- Use Next.js 15 Route Handler pattern (`app/api/webhooks/cloudmailin/route.ts`)
- Implement idempotency to handle duplicate webhook deliveries
- Consider timezone handling for meeting dates
