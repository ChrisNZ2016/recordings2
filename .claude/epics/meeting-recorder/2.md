---
name: Transcript Webhook Handler
status: open
created: 2025-10-16T03:45:15Z
updated: 2025-10-16T07:39:30Z
github: https://github.com/ChrisNZ2016/recordings2/issues/2
depends_on: [001, 004]
parallel: false
conflicts_with: []
---

# Task 005: Transcript Webhook Handler

## Description

Build /api/webhooks/recall endpoint to receive transcripts from recall.ai, validate signatures, update meetings with transcript data.

## Size

**M** - 16-24 hours

## Dependencies

- **[001]** - Database schema (needs meetings table)
- **[004]** - recall.ai integration (needs bot workflow)

## Conflicts

None

## Technical Details

### Webhook Endpoint

Create Next.js API route at `/api/webhooks/recall`:
- POST method for receiving webhook data
- Signature validation
- JSON payload parsing
- Rate limiting considerations

### Signature Validation

- Verify webhook authenticity using recall.ai signature
- Reject unsigned or invalid requests
- Log validation failures

### Transcript Processing

- Extract transcript data from webhook payload
- Handle different transcript formats
- Support for large transcript sizes
- Parse speaker information and timestamps

### Database Updates

- Update meetings table with transcript data
- Change meeting status to "completed"
- Store raw transcript JSON
- Update completed_at timestamp

### Idempotency

- Handle duplicate webhook deliveries
- Check for existing transcript data
- Use webhook ID for deduplication

### Error Handling

- Database write failures
- Malformed webhook payloads
- Missing meeting records
- Network timeouts

## Acceptance Criteria

- [ ] /api/webhooks/recall endpoint created
- [ ] recall.ai webhook signature validation
- [ ] Transcript data extracted and stored
- [ ] Meeting status updated to "completed"
- [ ] Handling for large transcripts
- [ ] Idempotency for duplicate webhooks
- [ ] Error logging with structured format
- [ ] Webhook responds with appropriate HTTP status codes
- [ ] Unit tests for signature validation
- [ ] Integration tests for webhook processing

## Security Considerations

- Validate webhook signatures before processing
- Rate limit webhook endpoint
- Sanitize transcript data before storage
- Log all webhook attempts for auditing

## Implementation Notes

- Use Next.js route handler format (app router)
- Store webhook secret in environment variables
- Consider using a queue for async processing
- Implement proper TypeScript types for webhook payload
- Add monitoring for webhook failures
