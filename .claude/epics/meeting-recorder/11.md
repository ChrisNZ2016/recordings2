---
name: Deployment & Configuration
status: open
created: 2025-10-16T03:45:15Z
updated: 2025-10-16T07:39:30Z
github: https://github.com/ChrisNZ2016/recordings2/issues/11
depends_on: [4, 7, 8, 9, 2, 3, 5, 6, 10]
parallel: false
conflicts_with: []
---

# Task 010: Deployment & Configuration

## Description

Configure environment variables, deploy to Vercel production, test end-to-end workflow with real services to ensure the entire system works in production.

## Size

M (16-24 hours)

## Dependencies

- **All previous tasks (001-009)**: Entire application must be complete before production deployment

## Conflicts

None

## Parallel Execution

No - final deployment task that depends on all others

## Acceptance Criteria

- [ ] All environment variables configured in Vercel
- [ ] Production deployment successful
- [ ] CloudMailin forwarding address configured
- [ ] recall.ai API key verified
- [ ] End-to-end test: email → bot creation → transcript → summary
- [ ] Database connection verified in production
- [ ] HTTPS enforced
- [ ] Vercel Analytics enabled
- [ ] Basic documentation created

## Technical Details

### Environment Variables

Configure in Vercel Dashboard (Settings → Environment Variables):

**Required Variables**:
```bash
# Database
DATABASE_URL=postgresql://user:pass@host:5432/dbname
DIRECT_URL=postgresql://user:pass@host:5432/dbname

# Recall.ai
RECALL_AI_API_KEY=your-recall-api-key
RECALL_AI_WEBHOOK_SECRET=your-webhook-secret

# OpenAI
OPENAI_API_KEY=sk-your-openai-key

# CloudMailin
CLOUDMAILIN_SECRET=your-cloudmailin-secret

# App Config
NEXT_PUBLIC_APP_URL=https://your-domain.vercel.app
NODE_ENV=production
```

**Optional Variables**:
```bash
# Vercel Analytics (usually auto-configured)
VERCEL_ANALYTICS_ID=auto

# Rate Limiting
RATE_LIMIT_WINDOW=60000
RATE_LIMIT_MAX_REQUESTS=100
```

### Deployment Checklist

1. **Vercel Project Setup**:
   - Connect GitHub repository
   - Set root directory to `recording2/`
   - Framework: Next.js
   - Node version: 18.x or later
   - Enable Turbopack for builds

2. **Database Setup**:
   - Supabase project created
   - Connection pooling enabled
   - Run all migrations from Task 001
   - Verify tables created correctly
   - Set up database backups

3. **CloudMailin Configuration**:
   - Create CloudMailin account
   - Set up forwarding address (e.g., meetings@yourdomain.cloudmailin.net)
   - Configure webhook URL: `https://your-domain.vercel.app/api/webhook/email`
   - Set format to JSON
   - Test with sample email

4. **Recall.ai Setup**:
   - Verify API key is active
   - Configure webhook URL: `https://your-domain.vercel.app/api/webhook/recall`
   - Test bot creation with sample meeting link
   - Verify webhook signature validation

5. **Domain Configuration**:
   - Add custom domain in Vercel (optional)
   - Enable automatic HTTPS
   - Configure DNS records if custom domain

6. **Vercel Settings**:
   - Enable Vercel Analytics
   - Set up error alerts
   - Configure log retention
   - Enable Web Analytics (optional)

### Testing Strategy

**End-to-End Test Flow**:

1. **Email Ingestion Test**:
   - Send test email to CloudMailin address
   - Include valid meeting link (Zoom/Google Meet)
   - Verify webhook receives email
   - Check logs for successful parsing

2. **Bot Creation Test**:
   - Verify bot creation API call succeeds
   - Check database for meeting record
   - Verify recall.ai bot joins meeting (if test meeting available)

3. **Transcript Test**:
   - Wait for meeting to complete or use test transcript
   - Verify webhook receives transcript
   - Check database for transcript storage
   - View transcript in dashboard UI

4. **Summary Test**:
   - Generate summary from dashboard
   - Verify OpenAI API call succeeds
   - Check summary saves to database
   - Verify summary displays correctly

5. **Error Scenarios**:
   - Test invalid email format
   - Test invalid meeting link
   - Test API rate limiting
   - Test database connection failure recovery

### Monitoring Setup

**Vercel Dashboard**:
- Monitor deployment status
- Check function logs
- Review error rates
- Monitor performance metrics

**Database Monitoring**:
- Supabase dashboard for connection pool
- Query performance
- Storage usage

**External Services**:
- CloudMailin delivery rate
- Recall.ai API usage
- OpenAI API usage and costs

### Documentation

Create `/recording2/README.md` with:
- Project overview
- Environment setup instructions
- Development workflow
- Deployment process
- API endpoint documentation
- Troubleshooting guide

Create `/recording2/DEPLOYMENT.md` with:
- Production deployment steps
- Environment variable reference
- Service configuration (CloudMailin, Recall.ai)
- Rollback procedures
- Common issues and solutions

### Security Checklist

- [ ] All API keys stored in environment variables (not in code)
- [ ] Webhook endpoints validate signatures
- [ ] Database uses connection pooling
- [ ] Rate limiting enabled on all webhooks
- [ ] HTTPS enforced (automatic with Vercel)
- [ ] CORS configured appropriately
- [ ] No sensitive data in logs
- [ ] Database credentials use minimal required permissions

### Performance Optimization

- [ ] Enable Turbopack for faster builds
- [ ] Configure caching headers for static assets
- [ ] Database indexes on frequently queried columns
- [ ] Consider edge functions for latency-sensitive endpoints
- [ ] Enable gzip compression (automatic with Vercel)
- [ ] Monitor bundle size and optimize if needed

## Testing Checklist

- [ ] All environment variables configured
- [ ] Production build succeeds
- [ ] Deployment to Vercel successful
- [ ] Database connection works in production
- [ ] CloudMailin forwarding configured and tested
- [ ] Recall.ai webhooks configured and tested
- [ ] OpenAI API key works
- [ ] Complete end-to-end test passes
- [ ] Error handling works in production
- [ ] Logs visible in Vercel dashboard
- [ ] Analytics tracking works
- [ ] Custom domain configured (if applicable)
- [ ] HTTPS enforced
- [ ] Rate limiting prevents abuse
- [ ] Dashboard UI loads correctly
- [ ] All API endpoints respond correctly
- [ ] Mobile responsive design verified
- [ ] Documentation complete

## Post-Deployment

**Monitor for 24-48 Hours**:
- Watch for any errors in logs
- Monitor API response times
- Check database performance
- Verify webhook deliveries
- Monitor OpenAI costs

**Gather Feedback**:
- Test with real meetings
- Document any issues
- Collect user feedback
- Plan improvements

**Maintenance Plan**:
- Set up automated backups
- Schedule dependency updates
- Plan for scaling if needed
- Monitor costs (Supabase, OpenAI, Vercel)

## Notes

- Use Vercel preview deployments for testing before production
- Keep `.env.local` up to date with production variables (without sensitive values)
- Document any manual steps required for deployment
- Consider setting up staging environment for larger changes
- Plan for database migrations on future schema changes
- Future: Set up CI/CD with automated tests
- Future: Add performance monitoring (Sentry, DataDog, etc.)
- Future: Implement feature flags for gradual rollouts
- Consider setting up status page for service health
